<include file="Public:header" />
<div id="main" class="main" >
    <div class="content">
        <div class="title">发布消息 - 项目消息 [ <a href="{:C('ADMIN_ROOT')}/Message/index">返回列表</a> ]</div>
        <div id="result" class="result none"></div>
        <script type="text/javascript" src="__PUBLIC__/admin/js/Validform_v5.3.2_min.js"></script>
        <script type="text/javascript" charset="utf-8" src="__PUBLIC__/admin/auth/js/editor/kindeditor-all.js"></script>
        <form id="frmMain" method='post' action="">
            <input type="hidden" name="type" value="4" />
            <table cellpadding=3 cellspacing=3 >
                <tr>
                    <td class="tRight">消息标题：</td>
                    <td class="tLeft" ><input type="text" class="huge bLeftRequire" datatype="*" id="title" name="title"></td>
                </tr>
                <tr>
                    <td class="tRight">作者：</td>
                    <td class="tLeft" ><input type="text" id="author" name="author" value="<?php echo $_SESSION[ADMIN_SESSION]['username']; ?>" maxlength="50"></td>
                </tr>
                <tr>
                    <td class="tRight">外部地址：</td>
                    <td class="tLeft" >
                        <input type="text" class="huge" id="url" name="url" placeholder="请以http://开头" value="">
                        <span style="color:red;">注:若要设置不跳转请输入"<b>javascript:;</b>"</span>
                    </td>
                </tr>
                <tr>
                    <td class="tRight">项目类型：</td>
                    <td class="tLeft" >
                        <select name="project_type">
                            <option value="0">所有类型</option>
                            <foreach name="project_type" item="item">
                                <option value="{$item.id}">{$item.cons_value}</option>
                            </foreach>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td class="tRight">项目ID：</td>
                    <td class="tLeft" ><input type="text" class="bLeftRequire" id="project_id" name="project_id" value="0" datatype="n"></td>
                </tr>
                <tr>
                    <td class="tRight">消息摘要：</td>
                    <td class="tLeft"><textarea id="summary" name="summary" class="huge" maxlength="255" style="height:80px;"></textarea></td>
                </tr>
                <tr>
                    <td class="tRight">详细内容：</td>
                    <td class="tLeft"><textarea id="description" name="description" class="huge bLeftRequire" style="height:450px;"></textarea></td>
                </tr>
                <tr>
                    <td></td>
                    <td class="center">
                        <div style="width:85%;margin:5px">
                            <input type="submit" value="保 存"  class="button small">
                            <input type="reset" class="button small" onclick="javascript:if(!confirm('确认重置吗?')) return false;resetEditor()" value="重 置" >
                        </div>
                    </td>
                </tr>
            </table>
        </form>
    </div>
</div>
<script>
    var _adding = false;
    var _layerIndex = 0;
    $(document).ready(function(){
        $("#frmMain").Validform({ // 表单验证
            tiptype: 3,
            callback: function(form){
                if(_adding) return;
                _adding = true;
                _layerIndex = layer.load('数据提交中...');
                $.ajax({
                    url: ROOT + '/message/add',
                    data: $('#frmMain').serialize(),
                    type: "POST",
                    cache: false,
                    success: function(msg) {
                        layer.close(_layerIndex);
                        if(msg.status){
                            layer.alert('添加成功~!', -1, function(){
                                window.location.href = msg.info;
                            });
                        }else{
                            layer.alert(msg.info);
                        }
                        _adding = false;
                    }
                });
                return false;
            }
        });
        KindEditor.ready(function(K){
            K.create('#description', {
                uploadJson : ROOT + '/Common/uploadImageForEditor',
                fileManagerJson : ROOT + '/Common/fileManagerForEditor',
                allowFileManager : true,
                urlType : 'domain',
                items : [
                    'source', '|', 'undo', 'redo', '|', 'preview', 'print', 'cut', 'copy', 'paste',
                    'plainpaste', 'wordpaste', '|', 'justifyleft', 'justifycenter', 'justifyright',
                    'justifyfull', 'insertorderedlist', 'insertunorderedlist', 'indent', 'outdent', 'subscript',
                    'superscript', 'clearhtml', 'selectall', '|', 'fullscreen', '/',
                    'formatblock', 'fontname', 'fontsize', '|', 'forecolor', 'hilitecolor', 'bold',
                    'italic', 'underline', 'strikethrough', 'lineheight', 'removeformat', '|', 'image',
                    'flash', 'media', 'insertfile', 'table', 'hr', 'emoticons', 'baidumap', 'pagebreak',
                    'anchor', 'link', 'unlink', '|', 'about'
                ],
                afterBlur: function(){this.sync();}
            });
        });
    });
</script>